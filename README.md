# sealog-vvan-merge
At the start of Kelly/OOI/2019/leg 2,  Webb Pinner updated sealog with a number of useful operational improvements. Unfortunately the update also introduced a bug that broke the delivery of events to Virtualvan. Any event that was based on the event template system (as opposed to a free text entry) was delivered incomplete to virtualvan, and consisted only of the template title and lacked the event option defined in the template drop down, also lacked any free text entry. He mostly fixed this bug during leg 4, but the leg 2, 3, and early leg 4 events in virtualvan were in error. The science party requested a fix.

The attached script was used to pull events from the Sealog record (which was healthy) and replace the incomplete event records in virtualvan. In its current form it is a one-off, as regexps and paths are hard-coded. Because users are permitted to create new event templates at any time, and the template configuration is saved on a dive by dive basis , the sealog content is processed dive by dive. in the script the virtual van EIC records are read twice, the first time to provide the framework in which to construct the replacement event records, the second time to write the new records in place of the old, broken ones.

One feature of the Sealog event logger is that it allows users to enter free text that includes commas. This interferes with simple methods of ingesting/splitting CSV files- I did not have access to sophisticated perl CSV modules because I did this work at sea. So I contacted Jimmy V and he provided me with a regexp that would replace commas in the free text field. The script 'pre.sh' is built from Jimmy's regexp and must be applied before the merge script.
